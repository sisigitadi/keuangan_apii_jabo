<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keuangan APII DPW Jabodetabek</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #F9F7F4 0%, #F5F3F1 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #D4AF37 0%, #C9A961 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 1.1em; }
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1em;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }
        .tab.active {
            background: white;
            color: #D4AF37;
            border-bottom: 3px solid #D4AF37;
        }
        .tab:hover { background: #e9ecef; }
        .content { padding: 30px; display: none; }
        .content.active { display: block; }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: linear-gradient(135deg, #D4AF37 0%, #C9A961 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .card h3 { font-size: 0.9em; opacity: 0.9; margin-bottom: 10px; }
        .card .amount { font-size: 2em; font-weight: bold; }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #D4AF37;
        }
        .btn {
            background: linear-gradient(135deg, #D4AF37 0%, #C9A961 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .btn:hover { transform: translateY(-2px); }
        .transaction-list {
            margin-top: 30px;
        }
        .transaction-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .transaction-item.income {
            border-left: 4px solid #28a745;
        }
        .transaction-item.expense {
            border-left: 4px solid #dc3545;
        }
        .transaction-info h4 {
            color: #333;
            margin-bottom: 5px;
        }
        .transaction-info p {
            color: #666;
            font-size: 0.9em;
        }
        .transaction-amount {
            font-size: 1.3em;
            font-weight: bold;
        }
        .transaction-amount.income { color: #28a745; }
        .transaction-amount.expense { color: #dc3545; }
        .btn-delete {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        .btn-delete:hover { background: #c82333; }
        @media (max-width: 768px) {
            .dashboard { grid-template-columns: 1fr; }
            .tabs { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 30px; width: 100%;">
                <div style="width: 80px; height: 80px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 2.5em; flex-shrink: 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    ðŸ’°
                </div>
                <div style="flex: 1;">
                    <h1 style="font-size: 1.8em; line-height: 1.3; color: white; margin: 0;">Aplikasi Pencatatan Keuangan<br>Yayasan Apologet Islam Indonesia<br>Dewan Pimpinan Wilayah Jabodetabek</h1>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="showTab('transaksi')">Tambah Transaksi</button>
            <button class="tab" onclick="showTab('laporan')">Laporan</button>
        </div>

        <div id="dashboard" class="content active">
            <div class="dashboard">
                <div class="card">
                    <h3>Aset Bersih</h3>
                    <div class="amount" id="totalAssets">Rp 0</div>
                </div>
                <div class="card">
                    <h3>Total Penerimaan</h3>
                    <div class="amount" id="totalIncome">Rp 0</div>
                </div>
                <div class="card">
                    <h3>Total Pengeluaran</h3>
                    <div class="amount" id="totalExpense">Rp 0</div>
                </div>
            </div>

            <h2 style="margin-bottom: 20px;">ðŸ“‹ Daftar Transaksi Terbaru</h2>
            <div id="transactionList" class="transaction-list"></div>
        </div>

        <div id="transaksi" class="content">
            <h2 style="margin-bottom: 20px;">âž• Tambah Transaksi Baru</h2>
            <form id="transactionForm">
                <div class="form-group">
                    <label for="date">Tanggal</label>
                    <input type="date" id="date" required>
                </div>
                <div class="form-group">
                    <label for="amount">Nominal (Rp)</label>
                    <input type="number" id="amount" min="0" required>
                </div>
                <div class="form-group">
                    <label for="type">Tipe</label>
                    <select id="typeSelect" required>
                        <option value="Penerimaan">Penerimaan</option>
                        <option value="Pengeluaran">Pengeluaran</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="category">Kategori</label>
                    <select id="categorySelect" required>
                        <option value="">Pilih kategori</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="description">Keterangan</label>
                    <textarea id="description" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn">ðŸ’¾ Simpan Transaksi</button>
            </form>
        </div>

        <div id="laporan" class="content">
            <h2 style="margin-bottom: 20px;">ðŸ“Š Laporan Keuangan</h2>
            <div class="dashboard">
                <div class="card">
                    <h3>Surplus/Defisit</h3>
                    <div class="amount" id="surplusDeficit">Rp 0</div>
                </div>
            </div>
            <div id="reportDetails" style="margin-top: 30px;"></div>
        </div>
    </div>

    <script>
        // Data Storage
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

        // Kategori berdasarkan PSAK 45
        const KATEGORI = {
            Penerimaan: [
                'Sumbangan/Donasi',
                'Hibah/Grant',
                'Pendapatan Program',
                'Pendapatan Investasi',
                'Pendapatan Lainnya'
            ],
            Pengeluaran: [
                'Program Utama',
                'Program Pendidikan',
                'Program Kesehatan',
                'Program Sosial',
                'Beban Penggajian',
                'Beban Administrasi',
                'Beban Operasional',
                'Beban Lainnya'
            ]
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const typeSelect = document.getElementById('typeSelect');
            const categorySelect = document.getElementById('categorySelect');
            const dateInput = document.getElementById('date');
            
            // Set today's date
            dateInput.valueAsDate = new Date();

            // Render kategori pertama kali
            renderCategoryOptions(typeSelect.value || 'Penerimaan');

            // Event: ubah tipe -> render ulang kategori
            typeSelect.addEventListener('change', function(e) {
                renderCategoryOptions(e.target.value);
            });

            // Load data
            updateDashboard();
            renderTransactions();
        });

        // Render kategori options
        function renderCategoryOptions(tipe) {
            const categorySelect = document.getElementById('categorySelect');
            categorySelect.innerHTML = '';
            
            const placeholder = document.createElement('option');
            placeholder.textContent = 'Pilih kategori';
            placeholder.value = '';
            placeholder.disabled = true;
            placeholder.selected = true;
            categorySelect.appendChild(placeholder);

            (KATEGORI[tipe] || []).forEach(nama => {
                const opt = document.createElement('option');
                opt.value = nama;
                opt.textContent = nama;
                categorySelect.appendChild(opt);
            });
        }

        // Tab switching
        function showTab(tabName) {
            const contents = document.querySelectorAll('.content');
            const tabs = document.querySelectorAll('.tab');
            
            contents.forEach(content => content.classList.remove('active'));
            tabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                updateDashboard();
                renderTransactions();
            } else if (tabName === 'laporan') {
                generateReport();
            }
        }

        // Form submission
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const transaction = {
                id: Date.now(),
                date: document.getElementById('date').value,
                amount: parseInt(document.getElementById('amount').value),
                type: document.getElementById('typeSelect').value,
                category: document.getElementById('categorySelect').value,
                description: document.getElementById('description').value
            };

            transactions.push(transaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            this.reset();
            document.getElementById('date').valueAsDate = new Date();
            renderCategoryOptions(document.getElementById('typeSelect').value);
            
            alert('âœ… Transaksi berhasil disimpan!');
            showTab('dashboard');
        });

        // Update Dashboard
        function updateDashboard() {
            const totalIncome = transactions
                .filter(t => t.type === 'Penerimaan')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpense = transactions
                .filter(t => t.type === 'Pengeluaran')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalAssets = totalIncome - totalExpense;

            document.getElementById('totalAssets').textContent = formatCurrency(totalAssets);
            document.getElementById('totalIncome').textContent = formatCurrency(totalIncome);
            document.getElementById('totalExpense').textContent = formatCurrency(totalExpense);
        }

        // Render transactions
        function renderTransactions() {
            const list = document.getElementById('transactionList');
            list.innerHTML = '';

            if (transactions.length === 0) {
                list.innerHTML = '<p style="text-align:center;color:#999;">Belum ada transaksi</p>';
                return;
            }

            transactions.sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10)
                .forEach(transaction => {
                    const item = document.createElement('div');
                    item.className = `transaction-item ${transaction.type === 'Penerimaan' ? 'income' : 'expense'}`;
                    item.innerHTML = `
                        <div class="transaction-info">
                            <h4>${transaction.category}</h4>
                            <p>${transaction.description}</p>
                            <p><small>${new Date
