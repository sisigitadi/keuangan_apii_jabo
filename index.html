<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pencatatan Keuangan - APII DPW Jabodetabek</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #F9F7F4 0%, #F5F3F1 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #D4AF37 0%, #C9A961 100%);
            color: white;
            padding: 30px;
            display: flex;
            align-items: center;
            gap: 30px;
        }
        .header-logo {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 1.8em;
            line-height: 1.3;
            color: white;
            margin: 0;
        }
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1em;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }
        .tab:hover {
            background: #e9ecef;
        }
        .tab.active {
            background: white;
            color: #D4AF37;
            border-bottom: 3px solid #D4AF37;
            margin-bottom: -2px;
        }
        .content {
            padding: 30px;
            display: none;
        }
        .content.active {
            display: block;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: linear-gradient(135deg, #D4AF37 0%, #C9A961 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        .card .amount {
            font-size: 2em;
            font-weight: bold;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #D4AF37;
        }
        .btn {
            background: linear-gradient(135deg, #D4AF37 0%, #C9A961 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .transaction-list {
            margin-top: 30px;
        }
        .transaction-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .transaction-item.income {
            border-left: 4px solid #28a745;
        }
        .transaction-item.expense {
            border-left: 4px solid #dc3545;
        }
        .transaction-info h4 {
            color: #333;
            margin-bottom: 5px;
        }
        .transaction-info p {
            color: #666;
            font-size: 0.9em;
        }
        .transaction-amount {
            font-size: 1.3em;
            font-weight: bold;
        }
        .transaction-amount.income {
            color: #28a745;
        }
        .transaction-amount.expense {
            color: #dc3545;
        }
        .btn-delete {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        .btn-delete:hover {
            background: #c82333;
        }
        .report-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .report-section h3 {
            color: #333;
            margin-bottom: 15px;
        }
        .report-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }
        .report-item:last-child {
            border-bottom: none;
        }
        h2 {
            color: #333;
            margin-bottom: 20px;
        }
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            .tabs {
                flex-direction: column;
            }
            .header {
                flex-direction: column;
                text-align: center;
            }
            .header h1 {
                font-size: 1.4em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-logo">üí∞</div>
            <div>
                <h1>Aplikasi Pencatatan Keuangan<br>Yayasan Apologet Islam Indonesia<br>Dewan Pimpinan Wilayah Jabodetabek</h1>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="switchTab('transaksi')">Tambah Transaksi</button>
            <button class="tab" onclick="switchTab('laporan')">Laporan</button>
        </div>

        <div id="dashboard" class="content active">
            <h2>üìä Dashboard Keuangan</h2>
            <div class="dashboard">
                <div class="card">
                    <h3>Aset Bersih</h3>
                    <div class="amount" id="totalAssets">Rp 0</div>
                </div>
                <div class="card">
                    <h3>Total Penerimaan</h3>
                    <div class="amount" id="totalIncome">Rp 0</div>
                </div>
                <div class="card">
                    <h3>Total Pengeluaran</h3>
                    <div class="amount" id="totalExpense">Rp 0</div>
                </div>
            </div>

            <h2>üìã Daftar Transaksi Terbaru</h2>
            <div id="transactionList" class="transaction-list"></div>
        </div>

        <div id="transaksi" class="content">
            <h2>‚ûï Tambah Transaksi Baru</h2>
            <form id="transactionForm">
                <div class="form-group">
                    <label for="date">Tanggal</label>
                    <input type="date" id="date" required>
                </div>
                <div class="form-group">
                    <label for="amount">Nominal (Rp)</label>
                    <input type="number" id="amount" min="0" required>
                </div>
                <div class="form-group">
                    <label for="typeSelect">Tipe</label>
                    <select id="typeSelect" required>
                        <option value="Penerimaan">Penerimaan</option>
                        <option value="Pengeluaran">Pengeluaran</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="categorySelect">Kategori</label>
                    <select id="categorySelect" required>
                        <option value="">Pilih kategori</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="description">Keterangan</label>
                    <textarea id="description" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn">üíæ Simpan Transaksi</button>
            </form>
        </div>

        <div id="laporan" class="content">
            <h2>üìä Laporan Keuangan</h2>
            <div class="dashboard">
                <div class="card">
                    <h3>Surplus/Defisit</h3>
                    <div class="amount" id="surplusDeficit">Rp 0</div>
                </div>
            </div>
            <div id="reportDetails" class="report-section"></div>
        </div>
    </div>

    <script>
        // Data storage
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

        // Kategori berdasarkan PSAK 45
        const KATEGORI = {
            Penerimaan: [
                'Sumbangan/Donasi',
                'Hibah/Grant',
                'Pendapatan Program',
                'Pendapatan Investasi',
                'Pendapatan Lainnya'
            ],
            Pengeluaran: [
                'Program Utama',
                'Program Pendidikan',
                'Program Kesehatan',
                'Program Sosial',
                'Beban Penggajian',
                'Beban Administrasi',
                'Beban Operasional',
                'Beban Lainnya'
            ]
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const typeSelect = document.getElementById('typeSelect');
            const categorySelect = document.getElementById('categorySelect');
            const dateInput = document.getElementById('date');
            
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            dateInput.value = today;

            // Render kategori pertama kali
            updateCategoryOptions(typeSelect.value);

            // Event: ubah tipe -> render ulang kategori
            typeSelect.addEventListener('change', function(e) {
                updateCategoryOptions(e.target.value);
            });

            // Handle form submission
            document.getElementById('transactionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addTransaction();
            });

            // Load initial data
            updateDashboard();
            renderTransactions();
        });

        // Update category options
        function updateCategoryOptions(tipe) {
            const categorySelect = document.getElementById('categorySelect');
            categorySelect.innerHTML = '';
            
            const placeholder = document.createElement('option');
            placeholder.textContent = 'Pilih kategori';
            placeholder.value = '';
            placeholder.disabled = true;
            placeholder.selected = true;
            categorySelect.appendChild(placeholder);

            const categories = KATEGORI[tipe] || [];
            categories.forEach(nama => {
                const opt = document.createElement('option');
                opt.value = nama;
                opt.textContent = nama;
                categorySelect.appendChild(opt);
            });
        }

        // Switch tab function - FIXED VERSION
        function switchTab(tabName) {
            // Hide all contents
            const contents = document.querySelectorAll('.content');
            contents.forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected content
            const selectedContent = document.getElementById(tabName);
            if (selectedContent) {
                selectedContent.classList.add('active');
            }

            // Add active class to clicked tab
            event.target.classList.add('active');

            // Update data when switching tabs
            if (tabName === 'dashboard') {
                updateDashboard();
                renderTransactions();
            } else if (tabName === 'laporan') {
                generateReport();
            }
        }

        // Add transaction
        function addTransaction() {
            const date = document.getElementById('date').value;
            const amount = parseInt(document.getElementById('amount').value);
            const type = document.getElementById('typeSelect').value;
            const category = document.getElementById('categorySelect').value;
            const description = document.getElementById('description').value;

            if (!category) {
                alert('Pilih kategori terlebih dahulu!');
                return;
            }

            const transaction = {
                id: Date.now(),
                date: date,
                amount: amount,
                type: type,
                category: category,
                description: description
            };

            transactions.push(transaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            // Reset form
            document.getElementById('transactionForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            updateCategoryOptions(document.getElementById('typeSelect').value);
            
            alert('‚úÖ Transaksi berhasil disimpan!');
            
            // Switch to dashboard to show the new transaction
            switchTab('dashboard');
        }

        // Update dashboard
        function updateDashboard() {
            const totalIncome = transactions
                .filter(t => t.type === 'Penerimaan')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpense = transactions
                .filter(t => t.type === 'Pengeluaran')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalAssets = totalIncome - totalExpense;

            document.getElementById('totalAssets').textContent = formatCurrency(totalAssets);
            document.getElementById('totalIncome').textContent = formatCurrency(totalIncome);
            document.getElementById('totalExpense').textContent = formatCurrency(totalExpense);
        }

        // Render transactions
        function renderTransactions() {
            const list = document.getElementById('transactionList');
            list.innerHTML = '';

            if (transactions.length === 0) {
                list.innerHTML = '<p style="text-align:center;color:#999;padding:20px;">Belum ada transaksi</p>';
                return;
            }

            // Sort by date (newest first)
            const sorted = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Show last 10 transactions
            sorted.slice(0, 10).forEach(transaction => {
                const item = document.createElement('div');
                const isIncome = transaction.type === 'Penerimaan';
                item.className = `transaction-item ${isIncome ? 'income' : 'expense'}`;
                
                const date = new Date(transaction.date).toLocaleDateString('id-ID');
                
                item.innerHTML = `
                    <div class="transaction-info">
                        <h4>${transaction.category}</h4>
                        <p>${transaction.description}</p>
                        <p><small>${date}</small></p>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="transaction-amount ${isIncome ? 'income' : 'expense'}">
                            ${isIncome ? '+' : '-'} ${formatCurrency(transaction.amount)}
                        </span>
                        <button class="btn-delete" onclick="deleteTransaction(${transaction.id})">üóëÔ∏è</button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // Delete transaction
        function deleteTransaction(id) {
            if (confirm('Yakin ingin menghapus transaksi ini?')) {
                transactions = transactions.filter(t => t.id !== id);
                localStorage.setItem('transactions', JSON.stringify(transactions));
                updateDashboard();
                renderTransactions();
            }
        }

        // Generate report
        function generateReport() {
            const totalIncome = transactions
                .filter(t => t.type === 'Penerimaan')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpense = transactions
                .filter(t => t.type === 'Pengeluaran')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const surplus = totalIncome - totalExpense;

            document.getElementById('surplusDeficit').textContent = formatCurrency(surplus);

            // Build report
            let reportHTML = '<h3>üìà Ringkasan Laporan Keuangan</h3>';
            reportHTML += '<div class="report-item">';
            reportHTML += '<span><strong>Total Penerimaan:</strong></span>';
            reportHTML += `<span style="color: #28a745; font-weight: bold;">${formatCurrency(totalIncome)}</span>`;
            reportHTML += '</div>';
            
            reportHTML += '<div class="report-item">';
            reportHTML += '<span><strong>Total Pengeluaran:</strong></span>';
            reportHTML += `<span style="color: #dc3545; font-weight: bold;">${formatCurrency(totalExpense)}</span>`;
            reportHTML += '</div>';
            
            reportHTML += '<div class="report-item" style="border-top: 2px solid #dee2e6; padding-top: 15px; margin-top: 15px;">';
            reportHTML += '<span><strong>Surplus/Defisit:</strong></span>';
            const surplusClass = surplus >= 0 ? 'color: #28a745;' : 'color: #dc3545;';
            reportHTML += `<span style="${surplusClass} font-weight: bold;">${formatCurrency(surplus)}</span>`;
            reportHTML += '</div>';

            document.getElementById('reportDetails').innerHTML = reportHTML;
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }
    </script>
</body>
</html>
